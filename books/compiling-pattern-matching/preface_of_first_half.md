---
title: 前半まえがき
---

世に出ているコンパイラの教科書は、Cなどの低級言語を想定したものが大半です。そのため、より高級な言語に求められる複雑な機能の実装方法はあまり紹介されていません。C言語のコンパイラであれば、1パスで全体のコンパイルを終わらせることも可能でしょう。しかし、より複雑な機能を持つ言語のコンパイラはそうもいきません。複雑な機能のそれぞれを、手順を踏んで解きほぐしながらコンパイルしていくことになります。

そのような複雑な機能のひとつに、関数型言語でよく採用されている**パターンマッチ**があります。パターンマッチは条件分岐を扱う機能であり、「高級なif文」とも捉えられますが、if文とは比較にならないほどの記述力を言語の利用者に提供してくれます。

本記事では、まずパターンマッチの基礎とコンパイラが吐くコードを示したあと、発展的なパターンをいくつか紹介します。また、パターンマッチの対象となる**代数的データ型**についても扱います。代数的データ型は、時に**タグ付きユニオン**とも呼ばれますが、本記事を読めばその理由もわかるでしょう。

なお、残念ながらパターンマッチのコンパイル技法については、そもそも関数型言語のコンパイラの本が少ないこともあってまとまった情報がありません。パターンマッチのコンパイルアルゴリズム、それに関連した検査アルゴリズム、最適化などについては、改めて将来の記事で解説する予定です。

パターンマッチの歴史は古く、1973年のSASLという言語にはすでにネスト可能なパターンマッチがあったようです[^1]。その後、さまざまな言語でパターンマッチが実装されてきました。本記事では、具体的な題材として、関数型言語Standard ML（SML）[^sml]のパターンマッチを取り上げます。SMLのパターンマッチは、いわば標準的なパターンマッチとでも呼べるものです。そのため、本記事で紹介する動作原理を当てはめれば、他の多くの言語のパターンマッチも理解できるでしょう。他の言語には、個別に拡張された機能もあるので、それらについても紹介します。

[^1]: [http://www.lambdadays.org/static/upload/media/1487239321204160davidturner.pdf](http://www.lambdadays.org/static/upload/media/1487239321204160davidturner.pdf)
[^sml]: [http://sml-family.org/](http://sml-family.org/) （非公式）

パターンマッチの動作原理が理解できれば、まだパターンマッチの機能がない他の言語にも同様の仕組みを移植したくなるかもしれません。そこで、パターンマッチをあとから導入した、しようとしている言語の紹介もします。

本稿の究極的な対象読者は、パターンマッチのある言語のコンパイラを作ろうとしている人です。とはいえ、SMLやパターンマッチの基本から解説していくので、広くプログラミング言語を使う人にとって有用な内容になると考えます。

本記事を読むにあたっては、以下の知識が必要です。

* プログラミングの経験
* C言語の基本的な素養。特に `struct` 、 `enum` 、 `union` 、 `switch` 、 `goto` を知っている必要があります
* SMLか、それに類する関数型言語の基本的素養。SMLの文法や挙動は逐一説明しますが、いわゆるC-like syntaxな言語しか知らないと、初見では少しハードルが高いと感じるかもしれません。
  困ったらコードを実際に動かして試しながら読み進めてみてください


本書は「著作権法」によって権利が保護されている著作物です。本書中の会社名や製品名に該当する各社の商標または登録商標です。本書の「前半まえがき」（本章）から「前半まとめと次回予告」までに掲載されている内容は、ラムダノート株式会社並びにκeenによりクリエイティブ・コモンズ・表示-非営利-継承4.0国際・ライセンス提供されています。
[![creativecommons by-nc-sa 4.0](/images/by-nc-sa.png)](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja)

